<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >


<mapper namespace="com.esuizhen.server.sync.dao.temp.TempPatientDao">
	<insert id="insert">
		INSERT INTO server_sync_temp_db.u_patient (
			patientId,patientNo,opFlag,patientCode,inpatientNo,userId,uuid,
			mobile,trueName,preTrueName,auditState,auditRemark,nickName,hasVisibleMedicalRecord,
			sex,birthDate,userPictureUrl,patientRelation,familyName,familyPhone,liveStatus,
			deathDate,causeOfDeath,underlyCausesOfDeath,isInHospitalDeath,isTumourDeath,bloodType,
			bloodTypeRH,bodyHeight,disabilityStatus,geneticDiseaseHistory,drugAllergyHistory,
			medicalPayType,sourceDiagnosis,sourceDiagnosis2,sourceDiagnosis3,sourceDiseaseCode,sourceDiseaseCode2,
			sourceDiseaseCode3,sourceDiseaseTypeId,sourceDiseaseTypeId2,sourceDiseaseTypeId3,sourceDiseaseTypeName,
			sourceDiseaseTypeName2,sourceDiseaseTypeName3,icdDiseaseTypeId,icdDiseaseTypeId2,diagnosisType,
			diagnosisType2,sourceTumorFlag,sourceTumorFlag2,confirmedDate,confirmedDate2,confirmedDate3,
			confirmedAge,confirmedAge2,diagnosisId,diagnosisId2,inhospitalId,inhospitalId2,sourcePathologyDiagnosis,
			sourcePathologyDiagnosis2,sourcePathologyDiseaseCode,sourcePathologyDiseaseCode2,secondaryDiagnosis,
			secondaryDiseaseCode,secondaryPathologyDiagnosis,secondaryPathologyDiseaseCode,attendingDoctor,
			attendingDoctorUuid,inchargeDoctor,inchargeDoctorUuid,followupFlag,lostFollowupCause,lostFollowupCauseResultValue,
			lostFollowupTime,oldFollowupFlag,oldLostFollowupCause,oldLostFollowupCauseResultValue,oldLostFollowupTime,
			createTime,updateTime,codePerson,codePersonName,outPatientFlag,inhospitalState,patientType,
			mergeFlag,mergeFrom,mergeFromUuid,mergeTarget,mergeTargetUuid,mergeTime,clinicNo,medicareCardNo,
			medicalCareAreaId,medicalCarePlace,famZipCode,rawCreateTime,lastAttendingDate,bodyWeight,
			cancelLostFollowupFlag,cancelLostFollowupTime,infoState,stafferType,specialDiseaseRegisterId,
			deathPatientIntoTask,lostPatientIntoTask,otherHospital,batchId,hospitalId
		)
		VALUES(
			#{patientId},#{patientNo},#{opFlag},#{patientCode},#{inpatientNo},#{userId},#{uuid},
			#{mobile},#{trueName},#{preTrueName},#{auditState},#{auditRemark},#{nickName},#{hasVisibleMedicalRecord},
			#{sex},#{birthDate},#{userPictureUrl},#{patientRelation},#{familyName},#{familyPhone},#{liveStatus},
			#{deathDate},#{causeOfDeath},#{underlyCausesOfDeath},#{isInHospitalDeath},#{isTumourDeath},#{bloodType},
			#{bloodTypeRH},#{bodyHeight},#{disabilityStatus},#{geneticDiseaseHistory},#{drugAllergyHistory},
			#{medicalPayType},#{sourceDiagnosis},#{sourceDiagnosis2},#{sourceDiagnosis3},#{sourceDiseaseCode},#{sourceDiseaseCode2},
			#{sourceDiseaseCode3},#{sourceDiseaseTypeId},#{sourceDiseaseTypeId2},#{sourceDiseaseTypeId3},#{sourceDiseaseTypeName},
			#{sourceDiseaseTypeName2},#{sourceDiseaseTypeName3},#{icdDiseaseTypeId},#{icdDiseaseTypeId2},#{diagnosisType},
			#{diagnosisType2},#{sourceTumorFlag},#{sourceTumorFlag2},#{confirmedDate},#{confirmedDate2},#{confirmedDate3},
			#{confirmedAge},#{confirmedAge2},#{diagnosisId},#{diagnosisId2},#{inhospitalId},#{inhospitalId2},#{sourcePathologyDiagnosis},
			#{sourcePathologyDiagnosis2},#{sourcePathologyDiseaseCode},#{sourcePathologyDiseaseCode2},#{secondaryDiagnosis},
			#{secondaryDiseaseCode},#{secondaryPathologyDiagnosis},#{secondaryPathologyDiseaseCode},#{attendingDoctor},
			#{attendingDoctorUuid},#{inchargeDoctor},#{inchargeDoctorUuid},#{followupFlag},#{lostFollowupCause},#{lostFollowupCauseResultValue},
			#{lostFollowupTime},#{oldFollowupFlag},#{oldLostFollowupCause},#{oldLostFollowupCauseResultValue},#{oldLostFollowupTime},
			#{createTime},#{updateTime},#{codePerson},#{codePersonName},#{outPatientFlag},#{inhospitalState},#{patientType},
			#{mergeFlag},#{mergeFrom},#{mergeFromUuid},#{mergeTarget},#{mergeTargetUuid},#{mergeTime},#{clinicNo},#{medicareCardNo},
			#{medicalCareAreaId},#{medicalCarePlace},#{famZipCode},#{rawCreateTime},#{lastAttendingDate},#{bodyWeight},
			#{cancelLostFollowupFlag},#{cancelLostFollowupTime},#{infoState},#{stafferType},#{specialDiseaseRegisterId},
			#{deathPatientIntoTask},#{lostPatientIntoTask},#{otherHospital},#{batchId},#{hospitalId}
		)
	</insert>

	<select id="queryPatientByBatchId" resultType="com.esuizhen.server.sync.model.temp.SyncPatient">
		SELECT
		IFNULL(t2.patientId,t21.patientId) patientId,
		IFNULL(t2.userId,t21.userId) userId,
		t1.patientNo,
		t1.opFlag,
		t1.patientCode,
		t1.inpatientNo,
		t1.uuid,
		t1.mobile,
		t1.trueName,
		t1.preTrueName,
		t1.auditState,
		t1.auditRemark,
		t1.nickName,
		t1.hasVisibleMedicalRecord,
		t1.sex,
		t1.birthDate,
		t1.userPictureUrl,
		t1.patientRelation,
		t1.familyName,
		t1.familyPhone,
		t1.liveStatus,
		t1.deathDate,
		t1.causeOfDeath,
		t1.underlyCausesOfDeath,
		t1.isInHospitalDeath,
		t1.isTumourDeath,
		t1.bloodType,
		t1.bloodTypeRH,
		t1.bodyHeight,
		t1.disabilityStatus,
		t1.geneticDiseaseHistory,
		t1.drugAllergyHistory,
		t1.medicalPayType,
		t1.sourceDiagnosis,
		t1.sourceDiagnosis2,
		t1.sourceDiagnosis3,
		t1.sourceDiseaseCode,
		t1.sourceDiseaseCode2,
		t1.sourceDiseaseCode3,
		t1.sourceDiseaseTypeId,
		t1.sourceDiseaseTypeId2,
		t1.sourceDiseaseTypeId3,
		t1.sourceDiseaseTypeName,
		t1.sourceDiseaseTypeName2,
		t1.sourceDiseaseTypeName3,
		t1.icdDiseaseTypeId,
		t1.icdDiseaseTypeId2,
		t1.diagnosisType,
		t1.diagnosisType2,
		t1.sourceTumorFlag,
		t1.sourceTumorFlag2,
		t1.confirmedDate,
		t1.confirmedDate2,
		t1.confirmedDate3,
		t1.confirmedAge,
		t1.confirmedAge2,
		t1.diagnosisId,
		t1.diagnosisId2,
		t1.inhospitalId,
		t1.inhospitalId2,
		t1.sourcePathologyDiagnosis,
		t1.sourcePathologyDiagnosis2,
		t1.sourcePathologyDiseaseCode,
		t1.sourcePathologyDiseaseCode2,
		t1.secondaryDiagnosis,
		t1.secondaryDiseaseCode,
		t1.secondaryPathologyDiagnosis,
		t1.secondaryPathologyDiseaseCode,
		IFNULL(t3.doctorId,t31.doctorId) attendingDoctor,
		t1.attendingDoctorUuid,
		IFNULL(t4.doctorId,t41.doctorId) inchargeDoctor,
		t1.inchargeDoctorUuid,
		t1.followupFlag,
		t1.lostFollowupCause,
		t1.lostFollowupCauseResultValue,
		t1.lostFollowupTime,
		t1.oldFollowupFlag,
		t1.oldLostFollowupCause,
		t1.oldLostFollowupCauseResultValue,
		t1.oldLostFollowupTime,
		t1.createTime,
		t1.updateTime,
		t1.codePerson,
		t1.codePersonName,
		t1.outPatientFlag,
		t1.inhospitalState,
		t1.patientType,
		t1.mergeFlag,
		t1.mergeFromUuid,
		t1.mergeTargetUuid,
		t1.mergeTime,
		t1.clinicNo,
		t1.medicareCardNo,
		t1.medicalCareAreaId,
		t1.medicalCarePlace,
		t1.famZipCode,
		t1.rawCreateTime,
		t1.lastAttendingDate,
		t1.bodyWeight,
		t1.cancelLostFollowupFlag,
		t1.cancelLostFollowupTime,
		t1.infoState,
		t1.stafferType,
		t1.specialDiseaseRegisterId,
		t1.deathPatientIntoTask,
		t1.lostPatientIntoTask,
		t1.otherHospital,
		t1.batchId,
		t1.hospitalId
		FROM server_sync_temp_db.u_patient t1
		LEFT JOIN user_db.u_patient t2 ON t1.uuid = t2.uuid
		LEFT JOIN user_db.r_uuid_patient_relationship t21 ON t1.uuid=t21.uuid
		LEFT JOIN user_db.u_doctor t3 ON t1.attendingDoctorUuid = t3.uuid
		LEFT JOIN user_db.r_uuid_doctor_relationship t31 ON t1.attendingDoctorUuid=t31.uuid
		LEFT JOIN user_db.u_doctor t4 ON t1.inchargeDoctorUuid = t4.uuid
		LEFT JOIN user_db.r_uuid_doctor_relationship t41 ON t1.inchargeDoctorUuid=t41.uuid
		WHERE t1.batchId=#{batchId}
	</select>
</mapper>